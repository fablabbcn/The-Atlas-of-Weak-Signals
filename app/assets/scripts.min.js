function Attractor(t,s,e){this.ws=t;var i=width-2*padding,a=i/grid,o=padding+a*(s+1);o-=a/2,i=height-2*padding;var r=padding+(a=i/grid)*(e+1);r-=a/2,this.pos=createVector(o,r),this.vel=createVector(0,0),this.acc=createVector(0,0),this.mass=6,this.G=20,this.scaler=5,this.calculateAttraction=function(t){var s=p5.Vector.sub(this.pos,t.pos);push();var e=255*noise(t.offset);stroke(color(50,50,50,e)),line(this.pos.x,this.pos.y,t.pos.x,t.pos.y),pop();var i=s.mag();i=constrain(i,50,55),s.normalize();var a=this.G*this.mass*t.mass/(i*i);return s.mult(a),s},this.applyForce=function(t){var s=t.copy();s.div(this.mass),this.acc.add(s)},this.update=function(){this.edges(),this.vel.add(this.acc),this.pos.add(this.vel),this.acc.set(0,0)},this.display=function(){push(),stroke(30,25,30),textAlign(CENTER,CENTER),pop()},this.edges=function(){this.pos.y>height&&(this.vel.y*=-1,this.pos=createVector(width/2,height/2),this.vel=createVector(0,0)),this.pos.x>width&&(this.vel.x*=-1,this.pos=createVector(width/2,height/2),this.vel=createVector(0,0)),this.pos.x<0&&(this.vel.x*=-1,this.pos=createVector(width/2,height/2),this.vel=createVector(0,0)),this.pos.y<0&&(this.vel.x*=-1,this.pos=createVector(width/2,height/2),this.vel=createVector(0,0))}}function Particle(t,s,e){this.atlas=e,this.offset=randomIntFromInterval(0,100)/100,this.pos=createVector(t,s),this.vel=createVector(random(-3,3),random(-3,3)),this.acc=createVector(0,-8),this.mass=10,this.G=5,this.previousVel=createVector(0,0),this.maxSpeed=3,this.theta=0,this.size=20,this.history=[],this.update=function(){if(this.offset+=.1,this.edges(),this.vel.add(this.acc),this.vel.limit(this.maxSpeed),this.pos.add(this.vel),this.acc.set(0,0),frameCount%10==1){var t=createVector(this.pos.x,this.pos.y);this.history.push(t),8<this.history.length&&this.history.splice(0,1)}},this.display=function(){this.trailing();this.vel.heading(),radians(90);this.theta+=this.vel.x*this.vel.mag()/20;push(),translate(this.pos.x,this.pos.y),textAlign(CENTER,CENTER),textSize(12),stroke(255),fill(225),text(this.atlas.kw,0,0),pop()},this.trailing=function(){for(var t=0;t<this.history.length;t++){var s=this.history[t];push(),translate(s.x,s.y),stroke("#f2dd1c"),fill(225),point(0,0),pop()}},this.edges=function(){this.pos.x<-this.size&&(this.pos.x=width+this.size),this.pos.y<-this.size&&(this.pos.y=height+this.size),this.pos.x>width+this.size&&(this.pos.x=-this.size),this.pos.y>height+this.size&&(this.pos.y=-this.size)},this.separate=function(t){for(var s=1.1*this.size,e=createVector(),i=0,a=0;a<t.length;a++){var o=p5.Vector.dist(this.pos,t[a].pos);if(0<o&&o<s){var r=p5.Vector.sub(this.pos,t[a].pos);r.normalize(),r.div(o),e.add(r),i++}}if(0<i){e.div(i),e.normalize(),e.mult(2*this.maxSpeed);var h=p5.Vector.sub(e,this.velocity);h.limit(this.maxforce),this.applyForce(h)}},this.applyForce=function(t){var s=t.copy();s.div(this.mass),this.acc.add(s)},this.calculateAttraction=function(t){var s=p5.Vector.sub(this.pos,t.pos),e=s.mag();s.normalize();var i=this.G*this.mass*t.mass/(e*e);return s.mult(i),s},this.applyGravity=function(){for(var t=0;t<attractors.length;t++){var s=attractors[t];if(s.ws===this.atlas.ws){var e=s.calculateAttraction(this);this.applyForce(e)}}}}var text1=new Blotter.Text("under construction ðŸ‘â€ðŸ—¨",{family:"Overpass Mono",size:84,fill:"#171717"}),text2=new Blotter.Text("ATLAS OF WEAK SIGNALS",{family:"'Nexa Bold', sans-serif",size:54,fill:"#171717"}),material=new Blotter.ChannelSplitMaterial,material2=new Blotter.FliesMaterial,blotter2=new Blotter(material2,{texts:text2}),scope2=blotter2.forText(text2);function randomIntFromInterval(t,s){return Math.floor(Math.random()*(s-t+1)+t)}scope2.appendTo(document.body),setTimeout(function(){var t=$(".b-canvas").detach();$(".modal").prepend(t)},2e3),function(){var t=document.createElement("SCRIPT");t.src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js",t.type="text/javascript",t.onload=function(){$("#close").click(function(t){t.preventDefault(),$(".modal").hide()})},document.getElementsByTagName("head")[0].appendChild(t)}(jQuery,window,document);var cnv,particles=[],limit=10,weaksignals=[],keywords=[],attractors=[],jsonData={},padding=100,grid=5;function preload(){jsonData=loadJSON("../data/fromspreadsheet.json"),console.log(jsonData)}var atlasObj=function(t,s){this.kw=s,this.ws=t};function centerCanvas(){cnv=createCanvas(windowWidth,windowHeight);var t=(windowWidth-width)/2,s=(windowHeight-height)/2;cnv.position(t,s)}function windowResized(){centerCanvas()}function setup(){centerCanvas(),setupWeakSignals(),textFont("Overpass Mono"),frameRate(60),setupObjects()}function draw(){background("#000"),clear();for(var t=0;t<particles.length;t++)particles[t].applyGravity(),particles[t].update(),particles[t].display();textSize(14),fill(0),attractors.forEach(function(t){t.update(),t.display()})}function setupObjects(){weaksignals.forEach(function(i,t){keywords[t].forEach(function(t,s){var e=new atlasObj(i,t);console.log(e),particles.push(new Particle(random(50,width-50),random(50,height-50),{ws:i,kw:t}))})})}function setupWeakSignals(){for(var t in jsonData){var s,e,i;if(5<jsonData[t].keywords.length){for(var a=[],o=0;o<5;o++)s=jsonData[t].keywords,e=Math.floor(Math.random()*s.length),i=s.splice(e,1),a.push(i[0]);console.log(a),jsonData[t].keywords=a.slice()}}o=0;var r=0;for(var t in jsonData)console.log(o,r),attractors.push(new Attractor(jsonData[t].name,o,r)),weaksignals.push(jsonData[t].name),keywords.push(jsonData[t].keywords),console.log("hit"),$(".s"+o+r).html("<h1>"+jsonData[t].name+"</h1>"),o==grid-1&&(r++,o=-1),o++}function reInit(){particles.splice(0,particles.length),weaksignals.splice(0,weaksignals.length),keywords.splice(0,keywords.length),attractors.splice(0,attractors.length),setupWeakSignals(),setupObjects()}setInterval(function(){reInit()},3e5);